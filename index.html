<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <!-- PWA Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Swiss Finance">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- App Version for Cache Busting -->
    <meta name="app-version" content="2.2.1">
    <meta name="build-time" content="2025-01-29T10:00:00Z">
    
    <title>ğŸ‡¨ğŸ‡­ Swiss Finance - Sven & Franzi</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <div class="desktop-sidebar">
            <h2 style="margin-bottom: 30px;">ğŸ‡¨ğŸ‡­ Swiss Finance</h2>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 40px; font-size: 14px;">Sven & Franzi</p>
            <nav>
                <div class="desktop-nav-item active" data-tab="dashboard">
                    <span class="nav-icon">ğŸ </span>
                    <span>Dashboard</span>
                </div>
                <div class="desktop-nav-item" data-tab="overview">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Ãœbersicht</span>
                </div>
                <div class="desktop-nav-item" data-tab="income">
                    <span class="nav-icon">ğŸ’µ</span>
                    <span>Einnahmen</span>
                </div>
                <div class="desktop-nav-item" data-tab="fixed">
                    <span class="nav-icon">ğŸ¢</span>
                    <span>Fixkosten</span>
                </div>
                <div class="desktop-nav-item" data-tab="variable">
                    <span class="nav-icon">ğŸ›’</span>
                    <span>Variable Ausgaben</span>
                </div>
                <div class="desktop-nav-item" data-tab="debts">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>Schulden</span>
                </div>
                <div class="desktop-nav-item" data-tab="savings">
                    <span class="nav-icon">ğŸ¦</span>
                    <span>Sparen</span>
                </div>
                <div class="desktop-nav-item" data-tab="wealth">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span>VermÃ¶gen</span>
                </div>
                <div class="desktop-nav-item" data-tab="shopping">
                    <span class="nav-icon">ğŸ›’</span>
                    <span>Lebensmittel</span>
                </div>
                <div class="desktop-nav-item" data-tab="transfers">
                    <span class="nav-icon">ğŸ’¸</span>
                    <span>ÃœbertrÃ¤ge</span>
                </div>
                <div class="desktop-nav-item" data-tab="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Einstellungen</span>
                </div>
            </nav>

            <!-- Profile Switcher in Sidebar -->
            <div style="margin-top: 40px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <h4 style="margin-bottom: 10px; font-size: 14px; opacity: 0.9; color: white;">ğŸ‘¥ Aktuelles Profil</h4>
                <div id="desktop-current-profile" style="font-weight: 600; color: white;">Familie</div>
            </div>
        </div>

        <!-- Mobile Layout -->
        <div class="mobile-layout">
            <!-- Header -->
            <div class="header">
                <h1>ğŸ‡¨ğŸ‡­ Swiss Finance</h1>
                <p>Sven & Franzi Finanzverwaltung</p>
                <div class="profile-switcher" onclick="toggleProfileDropdown()">
                    <span id="current-profile-name">ğŸ‘¥ Familie</span> â–¼
                    <div class="profile-dropdown" id="profile-dropdown">
                        <div class="profile-option" onclick="switchProfile('sven')">ğŸ‘¤ Sven</div>
                        <div class="profile-option" onclick="switchProfile('franzi')">ğŸ‘¤ Franzi</div>
                        <div class="profile-option active" onclick="switchProfile('family')">ğŸ‘¥ Familie</div>
                    </div>
                </div>
            </div>

            <!-- TAB 1: DASHBOARD -->
            <div id="tab-dashboard" class="tab-content active">
                <!-- Account Overview Cards -->
                <div class="dashboard-grid">
                    <!-- Account cards will be generated here by updateDashboard() -->
                </div>

                <!-- Key Metrics -->
                <div class="dashboard-metrics">
                    <div class="metric-card">
                        <div class="metric-label">Monatlich verfÃ¼gbar</div>
                        <div class="metric-value" id="dashboard-available">CHF 0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Offene Schulden</div>
                        <div class="metric-value negative" id="dashboard-debts">CHF 0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Sparquote</div>
                        <div class="metric-value" id="dashboard-savings-rate">0%</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-actions">
                    <button class="action-card" onclick="switchTab('income'); addSalaryEntry();">
                        <div class="action-icon">ğŸ’°</div>
                        <div class="action-label">Gehalt erfassen</div>
                    </button>
                    <button class="action-card" onclick="addQuickTransfer()">
                        <div class="action-icon">â†’</div>
                        <div class="action-label">Ãœbertrag erstellen</div>
                    </button>
                    <button class="action-card" onclick="switchTab('variable'); addNewExpense('variable');">
                        <div class="action-icon">+</div>
                        <div class="action-label">Ausgabe erfassen</div>
                    </button>
                    <button class="action-card" onclick="switchTab('wealth'); saveMonthData();">
                        <div class="action-icon">âœ“</div>
                        <div class="action-label">Monat speichern</div>
                    </button>
                </div>

                <!-- Expense Categories Donut Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Ausgaben nach Kategorien</h3>
                    </div>
                    <div id="expense-donut-chart" class="chart-content" style="height: 300px;">
                        <!-- Donut chart will be rendered here -->
                    </div>
                </div>

                <!-- Performance Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Performance</h3>
                    </div>
                    <div id="balance-chart" class="chart-content">
                        <!-- Chart will be rendered here -->
                    </div>
                </div>

                <!-- Total Summary - only for family profile -->
                <div class="total-summary" id="family-balance-summary">
                    <div class="summary-label">FamilienvermÃ¶gen Gesamt</div>
                    <div class="summary-value" id="total-family-balance">CHF 0</div>
                </div>
            </div>

            <!-- TAB 2: OVERVIEW -->
            <div id="tab-overview" class="tab-content">
                <!-- Spacing to prevent overlap -->
                <div style="height: 20px;"></div>
                <!-- Balance Hero -->
                <div class="balance-hero" style="margin-top: 0;">
                    <div class="balance-label">Kontostand <span id="overview-account-label">Familie Gesamt</span></div>
                    <div class="balance-amount" id="balance-display">CHF 0</div>
                    <div class="balance-trend" id="balance-trend">ğŸ“ˆ +CHF 0 monatlich</div>
                    <button class="balance-edit-btn" onclick="editAccountBalance()">âœï¸</button>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats overview-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-icon">ğŸ’°</div>
                        <div class="quick-stat-value" id="income-display">0</div>
                        <div class="quick-stat-label">Einkommen</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-icon">ğŸ’¸</div>
                        <div class="quick-stat-value" id="total-expenses-display">0</div>
                        <div class="quick-stat-label">Ausgaben</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-icon">ğŸ’±</div>
                        <div class="quick-stat-value" id="transfers-display">0</div>
                        <div class="quick-stat-label">ÃœbertrÃ¤ge</div>
                    </div>
                    <div class="quick-stat" id="available-stat">
                        <div class="quick-stat-icon">âœ…</div>
                        <div class="quick-stat-value" id="available-display">0</div>
                        <div class="quick-stat-label">VerfÃ¼gbar</div>
                    </div>
                </div>

                <div class="section-title" style="margin-bottom: 15px;">ğŸ’¡ Empfehlungen</div>
                <div id="recommendations-container">
                    <!-- Recommendations will be generated here -->
                </div>

                <div class="section-title" style="margin: 25px 0 15px;">ğŸ“Š Ausgaben nach Kategorien</div>
                <div id="categories-overview">
                    <!-- Categories will be generated here -->
                </div>
            </div>

            <!-- NEW TAB: INCOME - COMPLETELY REDESIGNED -->
            <div id="tab-income" class="tab-content">
                <!-- PROMINENT SALARY HERO SECTION -->
                <div class="salary-section" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 16px; padding: 40px; margin-bottom: 32px; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);">
                    <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 32px; text-align: center;">
                        ğŸ’° Monatliches Gehalt
                    </h2>
                    
                    <!-- Current Month Display -->
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 8px;">
                            <span id="current-month-display"></span>
                        </div>
                    </div>
                    
                    <!-- Main Salary Input Area -->
                    <div style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 32px; margin-bottom: 24px;">
                        <!-- Big Salary Display/Input -->
                        <div id="salary-input-container" style="text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px;">
                                Ihr Monatsgehalt (CHF)
                            </div>
                            
                            <!-- Large Input Field -->
                            <input type="number" 
                                   id="salary-main-input" 
                                   placeholder="0" 
                                   style="background: rgba(255, 255, 255, 0.95); 
                                          border: 3px solid rgba(255, 255, 255, 0.3); 
                                          border-radius: 12px; 
                                          padding: 20px; 
                                          font-size: 48px; 
                                          font-weight: 700; 
                                          text-align: center; 
                                          color: #059669; 
                                          width: 100%; 
                                          max-width: 400px;
                                          transition: all 0.3s ease;"
                                   onkeyup="updateSalaryPreview()"
                                   onfocus="this.style.borderColor='white'; this.style.boxShadow='0 0 0 4px rgba(255,255,255,0.3)';"
                                   onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none';">
                            
                            <!-- OR: Display Mode for Already Entered Salary -->
                            <div id="salary-display-mode" style="display: none;">
                                <div style="font-size: 56px; font-weight: 700; margin: 16px 0;">
                                    <span id="salary-amount-display">CHF 0</span>
                                </div>
                                <button onclick="editSalaryAmount()" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                                    âœï¸ Bearbeiten
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Preview Section -->
                    <div id="salary-preview" style="background: rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 24px; display: none;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                            <div>
                                <div style="font-size: 13px; opacity: 0.8;">Fixkosten</div>
                                <div style="font-size: 20px; font-weight: 600;" id="preview-fixed">CHF 0</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; opacity: 0.8;">Variable Kosten</div>
                                <div style="font-size: 20px; font-weight: 600;" id="preview-variable">CHF 0</div>
                            </div>
                        </div>
                        <div style="border-top: 2px solid rgba(255, 255, 255, 0.2); padding-top: 16px; text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">VerfÃ¼gbar nach AbzÃ¼gen</div>
                            <div style="font-size: 32px; font-weight: 700;" id="preview-available">CHF 0</div>
                        </div>
                    </div>
                    
                    <!-- Status Display -->
                    <div id="salary-status" style="background: rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 12px; margin-bottom: 20px; text-align: center;">
                        <strong>âš ï¸ Status:</strong> Noch kein Gehalt erfasst
                    </div>
                    
                    <!-- Main Action Button -->
                    <button id="salary-save-button" 
                            onclick="saveSalaryFromInput()" 
                            style="width: 100%; 
                                   background: white; 
                                   color: #059669; 
                                   border: none; 
                                   border-radius: 12px; 
                                   padding: 20px; 
                                   font-size: 18px; 
                                   font-weight: 700; 
                                   cursor: pointer; 
                                   transition: all 0.3s ease; 
                                   box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 12px rgba(0, 0, 0, 0.15)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                        ğŸ’° Gehalt speichern & Monat abschlieÃŸen
                    </button>
                    
                    <p style="margin-top: 16px; font-size: 13px; opacity: 0.9; text-align: center;">
                        Nach dem Speichern wird der Monat abgeschlossen und das verfÃ¼gbare Geld auf Ihr Konto Ã¼bertragen
                    </p>
                </div>
                
                <!-- SALARY HISTORY (Smaller Section) -->
                <div id="salary-history" style="margin-bottom: 24px;">
                    <!-- Will be filled by renderSalaryHistory() -->
                </div>
                
                <!-- ADDITIONAL INCOME (Secondary Section) -->
                <div class="settings-group" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div class="section-header">
                        <div class="section-title">ğŸ’µ ZusÃ¤tzliche Einnahmen</div>
                    </div>
                    
                    <!-- Quick Income Entry -->
                    <div style="margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px;">
                            <input type="text" class="form-input" id="quick-income-desc" placeholder="z.B. Bonus, Geschenk">
                            <input type="number" class="form-input" id="quick-income-amount" placeholder="Betrag" step="10">
                            <button onclick="addQuickIncome()" class="btn btn-primary">â• HinzufÃ¼gen</button>
                        </div>
                    </div>

                    <div id="additional-income-list">
                        <!-- Additional income entries will be generated here -->
                    </div>
                    
                    <div class="total-card" style="background: linear-gradient(135deg, #60a5fa, #3b82f6); margin-top: 20px;">
                        <div class="total-amount" id="income-total">CHF 0</div>
                        <div class="total-label">ZusÃ¤tzliche Einnahmen diesen Monat</div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: FIXED EXPENSES -->
            <div id="tab-fixed" class="tab-content">
                <div class="expense-section">
                    <div class="section-header">
                        <div class="section-title">ğŸ¢ Fixe Ausgaben</div>
                        <button class="add-button" onclick="addNewExpense('fixed')">
                            <span>â•</span>
                            <span>HinzufÃ¼gen</span>
                        </button>
                    </div>
                    <div id="fixed-expenses-list">
                        <!-- Fixed expenses will be generated here -->
                    </div>
                    <div class="total-card">
                        <div class="total-amount" id="fixed-total">CHF 0</div>
                        <div class="total-label">Summe Fixkosten</div>
                    </div>
                </div>
            </div>

            <!-- TAB 4: VARIABLE EXPENSES -->
            <div id="tab-variable" class="tab-content">
                <div class="expense-section">
                    <div class="section-header">
                        <div class="section-title">ğŸ›’ Variable Ausgaben</div>
                        <button class="add-button" onclick="addNewExpense('variable')">
                            <span>â•</span>
                            <span>HinzufÃ¼gen</span>
                        </button>
                    </div>
                    <div id="variable-expenses-list">
                        <!-- Variable expenses will be generated here -->
                    </div>
                    <div class="total-card">
                        <div class="total-amount" id="variable-total">CHF 0</div>
                        <div class="total-label">Summe variable Kosten</div>
                    </div>
                </div>
            </div>

            <!-- TAB 5: DEBTS/SCHULDEN -->
            <div id="tab-debts" class="tab-content">
                <div class="expense-section">
                    <div class="section-header">
                        <div class="section-title">ğŸ“‹ Offene Rechnungen & Schulden</div>
                        <button class="add-button" onclick="addNewDebt()">
                            <span>â•</span>
                            <span>HinzufÃ¼gen</span>
                        </button>
                    </div>
                    <div id="debts-list">
                        <!-- Debts will be generated here -->
                    </div>
                    <div class="total-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <div class="total-amount" id="debts-total">CHF 0</div>
                        <div class="total-label">Summe offene Schulden</div>
                    </div>

                    <!-- Debt categories overview -->
                    <div class="settings-group" style="margin-top: 20px;">
                        <div class="settings-title">ğŸ“Š Schulden nach Typ</div>
                        <div id="debt-categories">
                            <!-- Debt categories will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 6: SAVINGS & INVESTMENTS -->
            <div id="tab-savings" class="tab-content">
                <!-- Pillar 3a Section -->
                <div id="pillar3a-content">
                    <!-- Will be populated by renderPillar3aSection() -->
                </div>
                
                <!-- Compound Interest Calculator -->
                <div id="compound-calculator-content">
                    <!-- Will be populated by renderCompoundCalculator() -->
                </div>
                
                <!-- Performance Chart -->
                <div class="settings-group">
                    <div class="settings-title">ğŸ“Š Performance-Verlauf</div>
                    <div id="performance-chart" style="height: 200px; background: #f8f9fa; border-radius: 10px;">
                        <!-- Will be populated by renderPerformanceChart() -->
                    </div>
                </div>
                
                <!-- Other Investments -->
                <div id="investments-content">
                    <!-- Will be populated by renderInvestmentsSection() -->
                </div>
                
                <!-- Savings Recommendations -->
                <div class="settings-group">
                    <div class="settings-title">ğŸ’¡ Spar-Empfehlungen</div>
                    <div id="savings-recommendations">
                        <!-- Will be populated by updateSavingsRecommendations() -->
                    </div>
                </div>
            </div>

            <!-- TAB 7: WEALTH TRACKING -->
            <div id="tab-wealth" class="tab-content">
                <div class="settings-group">
                    <div class="settings-title">ğŸ“ˆ VermÃ¶gensentwicklung</div>
                    <div class="text-center" style="margin: 20px 0;">
                        <div style="font-size: 32px; font-weight: bold; color: #4facfe; margin-bottom: 10px;" id="wealth-display">CHF 0</div>
                        <p style="color: #666; margin-bottom: 20px;">Aktuelles GesamtvermÃ¶gen</p>
                        <button class="btn btn-primary" onclick="saveMonthData()" style="width: 100%;">
                            ğŸ“Š Monat abschlieÃŸen & speichern
                        </button>
                    </div>
                </div>

                <!-- Balance Management -->
                <div class="settings-group">
                    <div class="settings-title">ğŸ’° Kontostand verwalten</div>
                    <div class="form-row">
                        <label class="form-label">Aktueller Kontostand bearbeiten</label>
                        <input type="number" class="form-input" id="balance-input" placeholder="z.B. 12500">
                        <button class="btn btn-primary" onclick="updateBalance()" style="margin-top: 10px; width: 100%;">
                            ğŸ’¾ Kontostand aktualisieren
                        </button>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-title">ğŸ“Š Verlaufsdaten</div>
                    <div id="wealth-history">
                        <div class="text-center" style="padding: 40px 0; color: #666;">
                            <p>Noch keine Verlaufsdaten</p>
                            <p style="font-size: 14px; margin-top: 10px;">SchlieÃŸen Sie einen Monat ab, um den Verlauf zu sehen</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 8: FOOD BUDGET -->
            <div id="tab-shopping" class="tab-content">
                <!-- Family Budget Notice -->
                <div class="family-budget-notice">
                    <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familien-Budget fÃ¼r Lebensmittel</h4>
                    <p>Dieses Budget gilt fÃ¼r die gesamte Familie - alle Konten zusammen</p>
                </div>

                <div class="settings-group">
                    <div class="settings-title">ğŸ›’ Lebensmittel-Budget</div>
                    
                    <!-- Budget Overview -->
                    <div class="text-center" style="margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 5px;">Monats-Budget</div>
                                <div style="font-size: 18px; font-weight: bold; color: #4facfe;">CHF <span id="food-budget-total">800</span></div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 5px;">Ausgegeben</div>
                                <div style="font-size: 18px; font-weight: bold; color: #e74c3c;">CHF <span id="food-spent-total">0</span></div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 5px;">Noch verfÃ¼gbar</div>
                                <div style="font-size: 24px; font-weight: bold;" id="food-remaining-display">CHF 800</div>
                            </div>
                        </div>
                        
                        <!-- Budget Progress Bar -->
                        <div style="width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; margin-bottom: 15px; overflow: hidden;">
                            <div id="food-progress-bar" style="height: 100%; background: linear-gradient(90deg, #28a745, #ffc107, #dc3545); width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                        
                        <!-- Budget Status -->
                        <div id="food-budget-status" style="padding: 10px; border-radius: 10px; background: #d4edda; color: #155724; font-weight: 600;">
                            âœ… Budget im grÃ¼nen Bereich
                        </div>
                    </div>

                    <!-- Quick Add Purchase -->
                    <div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">ğŸ›’ Schnell-Eintrag</h4>
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-input" id="quick-shop-name" placeholder="z.B. Migros, Coop" style="margin-bottom: 0;">
                            <input type="number" class="form-input" id="quick-shop-amount" placeholder="Betrag" step="0.05" style="margin-bottom: 0;">
                            <button onclick="addQuickPurchase()" class="btn btn-primary" style="margin-bottom: 0;">â•</button>
                        </div>
                        <small style="color: #666;">Datum wird automatisch auf heute gesetzt</small>
                    </div>
                </div>

                <!-- Purchase History -->
                <div class="settings-group">
                    <div class="settings-title" style="margin-bottom: 15px;">ğŸ“‹ EinkÃ¤ufe diesen Monat</div>
                    <div id="food-purchases-list">
                        <div class="text-center" style="padding: 40px 0; color: #666;">
                            <p>ğŸ›’ Noch keine EinkÃ¤ufe erfasst</p>
                            <p style="font-size: 14px; margin-top: 10px;">Nutzen Sie den Schnell-Eintrag oben</p>
                        </div>
                    </div>
                </div>

                <!-- Budget Management -->
                <div class="settings-group">
                    <div class="settings-title">âš™ï¸ Budget verwalten</div>
                    <div class="form-row">
                        <label class="form-label">Monatliches Lebensmittel-Budget (CHF)</label>
                        <input type="number" class="form-input" id="food-budget-input" value="800" oninput="updateFoodBudget(this.value)">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="resetFoodBudget()">ğŸ—‘ï¸ Budget zurÃ¼cksetzen</button>
                        <button class="btn btn-primary" onclick="newMonthReset()">ğŸ“… Neuer Monat</button>
                    </div>
                </div>
            </div>

            <!-- TAB 9: TRANSFERS -->
            <div id="tab-transfers" class="tab-content">
                <div class="settings-group">
                    <div class="settings-title">ğŸ’¸ ÃœbertrÃ¤ge verwalten</div>
                    
                    <!-- Quick Transfer -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">âš¡ Schnell-Ãœbertrag</h4>
                        <div id="quick-transfer-area">
                            <!-- Content will be updated based on current profile -->
                        </div>
                    </div>
                    
                    <!-- Transfer Summary -->
                    <div id="transfer-summary" class="total-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                        <div class="total-amount" id="total-transfers-amount">CHF 0</div>
                        <div class="total-label">Gesamt-ÃœbertrÃ¤ge diesen Monat</div>
                    </div>
                </div>

                <!-- Transfer History -->
                <div class="settings-group">
                    <div class="settings-title">ğŸ“‹ Ãœbertrag-Historie</div>
                    <div id="transfers-history-detailed">
                        <div class="text-center" style="padding: 40px 0; color: #666;">
                            <p>Noch keine ÃœbertrÃ¤ge erstellt</p>
                            <p style="font-size: 14px; margin-top: 10px;">Erstellen Sie ÃœbertrÃ¤ge Ã¼ber das Dashboard</p>
                        </div>
                    </div>
                </div>

                <!-- Transfer Balance Overview -->
                <div class="settings-group">
                    <div class="settings-title">âš–ï¸ Ãœbertrag-Balance</div>
                    <div id="transfer-balance-overview">
                        <!-- Will be populated with balance information -->
                    </div>
                </div>
            </div>

            <!-- TAB 10: SETTINGS -->
            <div id="tab-settings" class="tab-content">
                <!-- Gist Link Display - PROMINENT DISPLAY -->
                <div id="gist-link-display" class="gist-link-section" style="display: none;">
                    <h4>ğŸ“„ Ihr Daten-Gist</h4>
                    <a id="gist-link" href="#" target="_blank" class="gist-link">
                        ğŸŒ Gist auf GitHub anzeigen
                    </a>
                    <div class="gist-info">
                        Alle Ihre Finanzdaten werden hier sicher gespeichert und zwischen GerÃ¤ten synchronisiert
                    </div>
                </div>

                <!-- GitHub Sync Setup -->
                <div class="settings-group" id="github-sync-setup">
                    <div class="settings-title">ğŸ“„ Cloud-Synchronisation Setup</div>
                    
                    <!-- Sync Status Display -->
                    <div id="sync-status" class="sync-status info">
                        <div id="sync-status-content">
                            <strong>ğŸ’¾ Nur lokaler Modus</strong><br>
                            <small>Konfigurieren Sie einen GitHub Token fÃ¼r Cloud-Sync</small>
                        </div>
                    </div>
                    
                    <!-- Token Input Section -->
                    <div class="token-input-section">
                        <h4>ğŸ” GitHub Token eingeben:</h4>
                        
                        <div class="form-row">
                            <label class="form-label">GitHub Personal Access Token</label>
                            <div class="token-input-row">
                                <input 
                                    type="password" 
                                    class="token-input form-input" 
                                    id="github-token-input" 
                                    placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                                    maxlength="200"
                                >
                                <button class="token-btn primary" onclick="saveGitHubToken()">
                                    ğŸ’¾ Speichern
                                </button>
                            </div>
                            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                ğŸ” Ihr Token wird sicher in diesem Browser gespeichert und nie Ã¼bertragen.
                            </small>
                        </div>
                        
                        <div class="token-buttons">
                            <button class="token-btn secondary" onclick="toggleTokenVisibility()" id="toggle-token-btn">
                                ğŸ‘ï¸ Token anzeigen
                            </button>
                            <button class="token-btn danger" onclick="removeTokenConfirm()">
                                ğŸ—‘ï¸ Token lÃ¶schen
                            </button>
                            <button class="token-btn primary" onclick="manualSync()" id="sync-now-btn">
                                ğŸ”„ Jetzt synchronisieren
                            </button>
                        </div>
                    </div>
                    
                    <!-- Token Creation Help -->
                    <div class="token-help">
                        <h4>ğŸ“‹ So erstellen Sie einen GitHub Token:</h4>
                        <ol>
                            <li>Gehen Sie zu <a href="https://github.com/settings/tokens" target="_blank"><strong>github.com/settings/tokens</strong></a></li>
                            <li>Klicken Sie <strong>"Generate new token (classic)"</strong></li>
                            <li>Name eingeben: <code>Swiss Finance Sync</code></li>
                            <li>Ablaufzeit: <strong>No expiration</strong> (fÃ¼r dauerhafte Sync)</li>
                            <li>Scope: Nur <strong>â˜‘ï¸ gist</strong> auswÃ¤hlen (fÃ¼r private Datenspeicherung)</li>
                            <li>Token kopieren und oben einfÃ¼gen</li>
                            <li>Auf "Speichern" klicken - fertig! ğŸ‰</li>
                        </ol>
                        <p style="margin-top: 10px; font-size: 13px; color: #666;">
                            <strong>ğŸ’¡ Tipp:</strong> Nach der Konfiguration synchronisieren sich alle Ihre GerÃ¤te automatisch!
                        </p>
                    </div>
                </div>

                <!-- DEBUG SECTION -->
                <div class="settings-group">
                    <div class="settings-title">ğŸ”§ Debug & Wartung</div>
                    
                    <!-- App Version Info -->
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="margin: 0; color: #1976d2; font-size: 14px;">
                            <strong>App Version:</strong> 2.2.1<br>
                            <strong>Build:</strong> <span id="build-time-display">2025-01-29</span><br>
                            <strong>Cache Status:</strong> <span id="cache-status">PrÃ¼fen...</span>
                        </p>
                    </div>
                    
                    <!-- Cache Management -->
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="margin: 0 0 10px 0; color: #856404; font-size: 14px;">
                            <strong>Cache-Problem?</strong> Falls die App vom Homescreen veraltete Daten zeigt, kÃ¶nnen Sie hier den Cache leeren.
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn btn-secondary" onclick="checkCacheStatus()" style="font-size: 12px;">
                                ğŸ” Cache prÃ¼fen
                            </button>
                            <button class="btn btn-secondary" onclick="clearAppCache()" style="font-size: 12px; background: #dc3545;">
                                ğŸ—‘ï¸ Cache leeren
                            </button>
                        </div>
                        <small style="color: #856404; font-size: 11px; display: block; margin-top: 8px;">
                            Cache leeren â†’ App neu laden â†’ Sync prÃ¼fen
                        </small>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="margin: 0; color: #856404; font-size: 14px;">
                            <strong>Problem mit ÃœbertrÃ¤gen?</strong> Falls falsche ZuflÃ¼sse angezeigt werden, kÃ¶nnen Sie hier die Transfer-Daten prÃ¼fen und bereinigen.
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-secondary" onclick="showTransferDebugInfo()" style="font-size: 12px;">
                            ğŸ” Debug Info
                        </button>
                        <button class="btn btn-secondary" onclick="resetAllTransferData()" style="font-size: 12px; background: #dc3545;">
                            ğŸ—‘ï¸ Transfers reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation - ALL TABS NOW VISIBLE -->
        <div class="bottom-nav">
            <div class="nav-buttons">
                <button class="nav-button active" data-tab="dashboard">
                    <span class="nav-icon">ğŸ </span>
                    Dashboard
                </button>
                <button class="nav-button" data-tab="overview">
                    <span class="nav-icon">ğŸ“Š</span>
                    Ãœbersicht
                </button>
                <button class="nav-button" data-tab="income">
                    <span class="nav-icon">ğŸ’µ</span>
                    Einnahmen
                </button>
                <button class="nav-button" data-tab="fixed">
                    <span class="nav-icon">ğŸ¢</span>
                    Fixkosten
                </button>
                <button class="nav-button" data-tab="variable">
                    <span class="nav-icon">ğŸ›’</span>
                    Variable
                </button>
                <button class="nav-button" data-tab="debts">
                    <span class="nav-icon">ğŸ“‹</span>
                    Schulden
                </button>
                <button class="nav-button" data-tab="savings">
                    <span class="nav-icon">ğŸ¦</span>
                    Sparen
                </button>
                <button class="nav-button" data-tab="wealth">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    VermÃ¶gen
                </button>
                <button class="nav-button" data-tab="shopping">
                    <span class="nav-icon">ğŸ›’</span>
                    Einkauf
                </button>
                <button class="nav-button" data-tab="transfers">
                    <span class="nav-icon">ğŸ’¸</span>
                    ÃœbertrÃ¤ge
                </button>
                <button class="nav-button" data-tab="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    Settings
                </button>
                <button class="nav-button" id="sync-btn" onclick="manualSync()">
                    <span class="nav-icon">ğŸ”„</span>
                    Sync
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="expense-modal-title">Ausgabe hinzufÃ¼gen</div>
                <button class="close-btn" onclick="closeModal('expense-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label">Bezeichnung</label>
                <input type="text" class="form-input" id="expense-name" placeholder="z.B. Miete, Lebensmittel">
            </div>
            <div class="form-row">
                <label class="form-label">Betrag (CHF)</label>
                <input type="number" class="form-input" id="expense-amount" placeholder="0.00" step="0.01">
            </div>
            <div class="form-row">
                <label class="form-label">Kategorie</label>
                <select class="form-input" id="expense-category">
                    <option value="">Kategorie wÃ¤hlen</option>
                    <optgroup label="ÃœbertrÃ¤ge">
                        <option value="ÃœbertrÃ¤ge">Ãœbertrag zum Gemeinschaftskonto</option>
                    </optgroup>
                    <optgroup label="Wohnen">
                        <option value="Wohnen">Miete/Hypothek</option>
                        <option value="Wohnen">Nebenkosten</option>
                        <option value="Wohnen">Strom</option>
                        <option value="Wohnen">Heizung</option>
                    </optgroup>
                    <optgroup label="Transport">
                        <option value="Transport">Auto Leasing</option>
                        <option value="Transport">Benzin</option>
                        <option value="Transport">Ã–V-Abo</option>
                        <option value="Transport">Versicherung</option>
                    </optgroup>
                    <optgroup label="Versicherungen">
                        <option value="Versicherungen">Krankenkasse</option>
                        <option value="Versicherungen">Lebensversicherung</option>
                        <option value="Versicherungen">Haftpflicht</option>
                    </optgroup>
                    <optgroup label="Familie & Kinder">
                        <option value="Familie">Kinderbetreuung</option>
                        <option value="Familie">Schule</option>
                        <option value="Familie">Kinderarzt</option>
                    </optgroup>
                    <optgroup label="Lebensmittel">
                        <option value="Lebensmittel">Groceries</option>
                        <option value="Lebensmittel">Restaurant</option>
                    </optgroup>
                    <optgroup label="Steuern">
                        <option value="Steuern">Bundessteuern</option>
                        <option value="Steuern">Kantonssteuern</option>
                        <option value="Steuern">Gemeindesteuern</option>
                        <option value="Steuern">Quellensteuer</option>
                        <option value="Steuern">Sonstige Steuern</option>
                    </optgroup>
                    <optgroup label="Sparen">
                        <option value="SÃ¤ule 3a">SÃ¤ule 3a</option>
                        <option value="SÃ¤ule 3b">SÃ¤ule 3b</option>
                        <option value="Notgroschen">Notgroschen</option>
                        <option value="Investitionen/ETFs">Investitionen/ETFs</option>
                        <option value="Aktien/Trading">Aktien/Trading</option>
                        <option value="Sparkonto">Sparkonto</option>
                    </optgroup>
                    <optgroup label="Gesundheit">
                        <option value="Gesundheit">Arzt/Zahnarzt</option>
                        <option value="Gesundheit">Medikamente</option>
                        <option value="Gesundheit">Brille/Kontaktlinsen</option>
                        <option value="Gesundheit">Fitnessstudio</option>
                        <option value="Gesundheit">Alternative Medizin</option>
                        <option value="Gesundheit">Wellness/Massage</option>
                    </optgroup>
                    <optgroup label="Entertainment">
                        <option value="Entertainment">Handy/Mobile</option>
                        <option value="Entertainment">Internet/WLAN</option>
                        <option value="Entertainment">Streaming (Netflix, Spotify)</option>
                        <option value="Entertainment">Gaming</option>
                        <option value="Entertainment">Kino/Theater</option>
                        <option value="Entertainment">BÃ¼cher/Magazine</option>
                        <option value="Entertainment">Hobbys</option>
                    </optgroup>
                    <optgroup label="Banking">
                        <option value="Banking">BankgebÃ¼hren</option>
                        <option value="Banking">KreditkartengebÃ¼hren</option>
                        <option value="Banking">ÃœberweisungsgebÃ¼hren</option>
                        <option value="Banking">BeratungsgebÃ¼hren</option>
                    </optgroup>
                    <optgroup label="Sonstiges">
                        <option value="Sonstiges">Kleidung</option>
                        <option value="Sonstiges">Geschenke</option>
                        <option value="Sonstiges">Diverses</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">Konto</label>
                <select class="form-input" id="expense-account">
                    <option value="sven">Sven Privat</option>
                    <option value="franzi">Franzi Privat</option>
                    <option value="shared">Gemeinschaftskonto</option>
                </select>
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="saveExpense()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('expense-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="income-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="income-modal-title">Einnahme hinzufÃ¼gen</div>
                <button class="close-btn" onclick="closeModal('income-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label">Beschreibung</label>
                <input type="text" class="form-input" id="income-description" placeholder="z.B. Bonus, Geschenk, SteuerrÃ¼ckzahlung">
            </div>
            <div class="form-row">
                <label class="form-label">Betrag (CHF)</label>
                <input type="number" class="form-input" id="income-amount" placeholder="0.00" step="0.01">
            </div>
            <div class="form-row">
                <label class="form-label">Typ</label>
                <select class="form-input" id="income-type">
                    <option value="">Typ wÃ¤hlen</option>
                    <option value="Bonus">Bonus</option>
                    <option value="Geschenk">Geschenk</option>
                    <option value="SteuerrÃ¼ckzahlung">SteuerrÃ¼ckzahlung</option>
                    <option value="Nebeneinkommen">Nebeneinkommen</option>
                    <option value="Verkauf">Verkauf</option>
                    <option value="Dividende">Dividende</option>
                    <option value="Zinsen">Zinsen</option>
                    <option value="Sonstiges">Sonstiges</option>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">Konto</label>
                <select class="form-input" id="income-account">
                    <option value="sven">Sven Privat</option>
                    <option value="franzi">Franzi Privat</option>
                    <option value="shared">Gemeinschaftskonto</option>
                </select>
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="saveIncome()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('income-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Balance Edit Modal -->
    <div id="balance-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="balance-modal-title">ğŸ’° Kontostand bearbeiten</div>
                <button class="close-btn" onclick="closeModal('balance-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label" id="balance-modal-label">Neuer Kontostand (CHF)</label>
                <input type="number" class="form-input" id="balance-modal-input" placeholder="z.B. 12500" step="100">
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="updateBalanceFromModal()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('balance-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Debt Modal -->
    <div id="debt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="debt-modal-title">Schulden/Rechnung hinzufÃ¼gen</div>
                <button class="close-btn" onclick="closeModal('debt-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label">Bezeichnung</label>
                <input type="text" class="form-input" id="debt-name" placeholder="z.B. Steuern 2024, Visa Karte">
            </div>
            <div class="form-row">
                <label class="form-label">Betrag (CHF)</label>
                <input type="number" class="form-input" id="debt-amount" placeholder="0.00" step="0.01">
            </div>
            <div class="form-row">
                <label class="form-label">Typ</label>
                <select class="form-input" id="debt-type">
                    <option value="">Typ wÃ¤hlen</option>
                    <option value="Offene Steuern">Offene Steuern</option>
                    <option value="Kreditkarte">Kreditkarte</option>
                    <option value="Offene Rechnung">Offene Rechnung</option>
                    <option value="Privatdarlehen">Privatdarlehen</option>
                    <option value="Leasing">Leasing</option>
                    <option value="Sonstiges">Sonstiges</option>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">Wer schuldet?</label>
                <select class="form-input" id="debt-owner">
                    <option value="sven">Sven</option>
                    <option value="franzi">Franzi</option>
                    <option value="shared">Gemeinsam</option>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">FÃ¤lligkeitsdatum</label>
                <input type="date" class="form-input" id="debt-due-date">
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="saveDebt()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('debt-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Pillar 3a Value Modal -->
    <div id="pillar3a-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ˆ SÃ¤ule 3a Fondswert erfassen</div>
                <button class="close-btn" onclick="closeModal('pillar3a-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label">Aktueller Fondswert (CHF)</label>
                <input type="number" class="form-input" id="pillar3a-value" placeholder="z.B. 15000" step="100">
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                    Der aktuelle Gesamtwert Ihres SÃ¤ule 3a Fonds
                </small>
            </div>
            <div class="form-row">
                <label class="form-label">Einzahlung diesen Monat (CHF)</label>
                <input type="number" class="form-input" id="pillar3a-deposit" value="588" step="10">
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                    Monatliche Einzahlung (Standard: CHF 588 = 7056/12)
                </small>
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="savePillar3aValue()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('pillar3a-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Investment Modal -->
    <div id="investment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ’ Investment hinzufÃ¼gen</div>
                <button class="close-btn" onclick="closeModal('investment-modal')">Ã—</button>
            </div>
            <div class="form-row">
                <label class="form-label">Investment Name</label>
                <input type="text" class="form-input" id="investment-name" placeholder="z.B. MSCI World ETF, Bitcoin">
            </div>
            <div class="form-row">
                <label class="form-label">Investierter Betrag (CHF)</label>
                <input type="number" class="form-input" id="investment-amount" placeholder="z.B. 5000" step="100">
            </div>
            <div class="form-row">
                <label class="form-label">Aktueller Wert (CHF)</label>
                <input type="number" class="form-input" id="investment-value" placeholder="z.B. 5500" step="100">
            </div>
            <div class="form-row">
                <label class="form-label">Typ</label>
                <select class="form-input" id="investment-type">
                    <option value="ETF">ETF</option>
                    <option value="Aktien">Aktien</option>
                    <option value="Bitcoin">Bitcoin</option>
                    <option value="Crypto">Andere Krypto</option>
                    <option value="Gold">Gold</option>
                    <option value="Immobilien">Immobilien</option>
                    <option value="Andere">Andere</option>
                </select>
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="saveInvestment()">ğŸ’¾ Speichern</button>
                <button class="btn btn-secondary" onclick="closeModal('investment-modal')">â†© Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/github-sync.js"></script>
    <script src="js/transfers.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/income.js"></script>
    <script src="js/savings.js"></script>
    <script src="js/debts.js"></script>
    <script src="js/food-budget.js"></script>
    <script src="js/wealth.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>

    <!-- Inline Scripts for Income Tab -->
    <script>
    // Update current month display
    document.addEventListener('DOMContentLoaded', function() {
        const monthDisplay = document.getElementById('current-month-display');
        if (monthDisplay) {
            const currentMonth = new Date().toLocaleDateString('de-CH', { month: 'long', year: 'numeric' });
            monthDisplay.textContent = currentMonth;
        }
    });

    // Live preview function
    function updateSalaryPreview() {
        const input = document.getElementById('salary-main-input');
        const preview = document.getElementById('salary-preview');
        const amount = parseFloat(input.value) || 0;
        
        if (amount > 0 && typeof appData !== 'undefined') {
            preview.style.display = 'block';
            
            // Calculate expenses
            const fixedExpenses = appData.fixedExpenses
                .filter(exp => exp.active && exp.account === appData.currentProfile)
                .reduce((sum, exp) => sum + exp.amount, 0);
            const variableExpenses = appData.variableExpenses
                .filter(exp => exp.active && exp.account === appData.currentProfile)
                .reduce((sum, exp) => sum + exp.amount, 0);
            const available = amount - fixedExpenses - variableExpenses;
            
            document.getElementById('preview-fixed').textContent = `CHF ${fixedExpenses.toLocaleString()}`;
            document.getElementById('preview-variable').textContent = `CHF ${variableExpenses.toLocaleString()}`;
            document.getElementById('preview-available').textContent = `CHF ${available.toLocaleString()}`;
            
            // Color code the available amount
            const availableElement = document.getElementById('preview-available');
            if (available < 0) {
                availableElement.style.color = '#fca5a5';
            } else if (available < 500) {
                availableElement.style.color = '#fde047';
            } else {
                availableElement.style.color = 'white';
            }
        } else {
            preview.style.display = 'none';
        }
    }

    // Save salary from the big input field
    function saveSalaryFromInput() {
        const input = document.getElementById('salary-main-input');
        const amount = parseFloat(input.value);
        
        if (!amount || amount <= 0) {
            alert('âš ï¸ Bitte geben Sie Ihr Gehalt ein');
            input.focus();
            return;
        }
        
        // Call the function from income.js
        if (typeof addSalaryEntryWithAmount === 'function') {
            addSalaryEntryWithAmount(amount);
        } else if (typeof addSalaryEntry === 'function') {
            // Fallback to prompt-based entry
            addSalaryEntry();
        }
    }

    // Edit already entered salary
    function editSalaryAmount() {
        document.getElementById('salary-input-container').querySelector('#salary-display-mode').style.display = 'none';
        document.getElementById('salary-main-input').style.display = 'block';
        document.getElementById('salary-main-input').focus();
    }
    </script>
</body>
</html>
